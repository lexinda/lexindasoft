<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lexindasoftservice.dao.AdminDao">

	<!-- 根据id获取系统管理员信息 -->
	<select id="getAdminById" parameterType="int" resultType="Admin">
		SELECT id,
			account,
			password,
			name,
			email,
			phone,
			status,
			init_password as initPassword,
			is_initpwd as isInitpwd,
			birth_day as birthDay,
			update_pwdtime as updatePwdtime,
			create_time as createTime,
			update_time as updateTime
		FROM admin
		WHERE id = #{id}
	</select>
	
	<update id="updateAdminInfo" parameterType="Admin">
		UPDATE admin SET name = #{name},
		account = #{account},phone=#{phone},birth_day=#{birthDay},email = #{email}, status = #{status}, update_time = now() 
		WHERE id = #{id}
	</update>
	
	<!-- 保存系统管理员信息：存在则修改，否则更新 -->
	<insert id="insertAdminInfo" parameterType="Admin" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO admin(name, account, password,email,phone, status,init_password,is_initpwd,birth_day,update_pwdtime, create_time, update_time)
		VALUES(#{name}, #{account}, #{password},#{email},#{phone},#{status},#{initPassword},0,#{birthDay},now(), now(), now())
	</insert>
	
	<!-- 根据id删除系统管理员信息 -->
	<delete id="deleteAdminInfo" parameterType="String" >
	   DELETE FROM admin WHERE id in (#{id})
	</delete>
	<!-- 根据id获取系统管理员信息 -->
	<select id="login" parameterType="Admin" resultType="Admin">
		SELECT id,
			account,
			password,
			name,
			email,
			phone,
			status,
			init_password as initPassword,
			is_initpwd as isInitpwd,
			birth_day as birthDay,
			update_pwdtime as updatePwdtime,
			create_time as createTime,
			update_time as updateTime
		FROM admin
		WHERE account=#{account} and password=#{password}
	</select>
	<!-- 保存系统管理员信息：存在则修改，否则更新 -->
	<update id="updatePwd" parameterType="Admin">
		UPDATE admin SET 
		password = #{password},
		init_password=null,
		is_initpwd=1,
		update_pwdtime=now(),
	    update_time = now() 
		WHERE id = #{id}
	</update>
	
	<!-- 根据id获取系统管理员信息 -->
	<select id="getAllAdminList" parameterType="Admin" resultType="Admin">
		SELECT id,
			account,
			password,
			name,
			email,
			phone,
			status,
			init_password as initPassword,
			is_initpwd as isInitpwd,
			birth_day as birthDay,
			update_pwdtime as updatePwdtime,
			create_time as createTime,
			update_time as updateTime
		FROM `admin`
		WHERE 1=1 
		<if test="account != null">
			and account like CONCAT('%',#{account},'%')
		</if>
		
		<if test="page != -1">
			limit #{page},#{pageNum}
		</if>
		
	</select>

</mapper>  